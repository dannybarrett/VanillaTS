var __awaiter=this&&this.__awaiter||function(e,d,o,c){return new(o=o||Promise)(function(t,n){function l(e){try{i(c.next(e))}catch(e){n(e)}}function r(e){try{i(c.throw(e))}catch(e){n(e)}}function i(e){var n;e.done?t(e.value):((n=e.value)instanceof o?n:new o(function(e){e(n)})).then(l,r)}i((c=c.apply(e,d||[])).next())})};const elements=document.body.children;function lookForCustomElements(n){for(let e=0;e<n.length;e++)console.log(n[e].nodeName),n[e].hasAttribute("client")&&handleCSRLink(n[e]),n[e].hasChildNodes()&&lookForCustomElements(n[e].children)}let replaceElements=[],addedElements=[];function handleCSRLink(e){return __awaiter(this,void 0,void 0,function*(){let t=e;t.addEventListener("click",e=>__awaiter(this,void 0,void 0,function*(){e.preventDefault();const n=new XMLHttpRequest;n.onload=()=>{var e=n.response.body;changeDifferences(document.body,e).then(()=>{var t;for(let n=0;n<replaceElements.length;n++){let e=replaceElements[n].prevElement;var l=replaceElements[n].nextElement;"SCRIPT"===e.nodeName?e.before(l):null!==(t=e.parentNode)&&void 0!==t&&t.replaceChild(l,e)}for(let e=0;e<addedElements.length;e++){let n=addedElements[e].parent,t=addedElements[e].element;if("SCRIPT"===t.nodeName){let e=document.createElement("script");e.setAttribute("src",t.getAttribute("src")),n.append(e)}else n.appendChild(t)}}).catch(e=>{console.error(e)})},n.open("GET",t.getAttribute("href")||"/"),n.responseType="document",n.send()}))})}function changeDifferences(l,r){return __awaiter(this,void 0,void 0,function*(){if(l.nodeName===r.nodeName){if(0===l.children.length||0===r.children.length)return l.innerHTML===r.innerHTML?void 0:void(l.innerHTML=r.innerHTML);if(l.hasChildNodes()&&l.children.length===r.children.length)for(let e=0;e<l.children.length;e++)yield changeDifferences(l.children[e],r.children[e]);else{if(l.children.length>r.children.length){var n=l.children.length-r.children.length,t=l.children.length-1;for(let e=t;e>t-n;e--)console.log(`Removing prevElement: ${l.children[e].nodeName}`),l.removeChild(l.children[e]);yield changeDifferences(l,r)}if(l.children.length<r.children.length){r.children.length,l.children.length;for(let e=l.children.length;e<r.children.length;e++)addedElements.push({element:r.children[e],parent:r}),r.removeChild(r.children[e]);yield changeDifferences(l,r)}}}else replaceElements.push({prevElement:l,nextElement:r})})}lookForCustomElements(elements);